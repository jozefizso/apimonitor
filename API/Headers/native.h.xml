<!--
    API Monitor Definitions
    (c) 2010-2011, Rohitab Batra <rohitab@rohitab.com>
    http://www.rohitab.com/apimonitor/
-->
<ApiMonitor>
    <Include Filename="Headers\security.h.xml" />
    <Include Filename="Headers\windows.h.xml" />
    <Headers>
        
        <!-- Variables -->
        <Variable Name="BYTE [IMAGE_SIZEOF_SHORT_NAME]" Type="Array" Base="BYTE" Count="8" />

        <!-- TODO: Structures (Different for 32/64) -->
        <Variable Name="PIMAGE_NT_HEADERS"          Type="Alias"    Base="LPVOID" />
        <Variable Name="PIMAGE_NT_HEADERS*"         Type="Pointer"  Base="PIMAGE_NT_HEADERS" />

        <!-- [IMAGE_SECTION_HEADER_u] -->
        <Variable Name="[IMAGE_SECTION_HEADER_u]" Type="Union">
            <Display Name="union" />
            <Field Type="DWORD"     Name="PhysicalAddress" />
            <Field Type="DWORD"     Name="VirtualSize" />
        </Variable>

        <!-- IMAGE_SECTION_HEADER -->
        <Variable Name="IMAGE_SECTION_HEADER" Type="Struct">
            <Field Type="BYTE [IMAGE_SIZEOF_SHORT_NAME]"    Name="Name" />
            <Field Type="[IMAGE_SECTION_HEADER_u]"          Name="Misc" />
            <Field Type="DWORD"                             Name="VirtualAddress" />
            <Field Type="DWORD"                             Name="SizeOfRawData" />
            <Field Type="DWORD"                             Name="PointerToRawData" />
            <Field Type="DWORD"                             Name="PointerToRelocations" />
            <Field Type="DWORD"                             Name="PointerToLinenumbers" />
            <Field Type="WORD"                              Name="NumberOfRelocations" />
            <Field Type="WORD"                              Name="NumberOfLinenumbers" />
            <Field Type="DWORD"                             Name="Characteristics" />
        </Variable>
        <Variable Name="PIMAGE_SECTION_HEADER"  Type="Pointer" Base="IMAGE_SECTION_HEADER" />
        <Variable Name="PIMAGE_SECTION_HEADER*" Type="Pointer" Base="PIMAGE_SECTION_HEADER" />

        <!-- EVENT_TYPE -->
        <Variable Name="EVENT_TYPE" Type="Alias" Base="UINT">
            <Enum>
                <Set Name="NotificationEvent"       Value="0" />
                <Set Name="SynchronizationEvent"    Value="1" />
            </Enum>
        </Variable>

        <Variable Name="[FileShareMode]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Flag>
                <Set Name="FILE_SHARE_READ"     Value="0x00000001" />
                <Set Name="FILE_SHARE_WRITE"    Value="0x00000002" />
                <Set Name="FILE_SHARE_DELETE"   Value="0x00000004" />
            </Flag>
        </Variable>

        <!-- [MemoryType] -->
        <Variable Name="[MemoryType]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Flag>
                <Set Name="MEM_IMAGE"   Value="0x1000000" />
                <Set Name="MEM_MAPPED"  Value="0x40000" />
                <Set Name="MEM_PRIVATE" Value="0x20000" />
            </Flag>
        </Variable>

        <!-- [MemoryAllocationFlags] -->
        <Variable Name="[MemoryAllocationFlags]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Flag>
                <Set Name="MEM_COMMIT"          Value="0x1000" />
                <Set Name="MEM_RESERVE"         Value="0x2000" />
                <Set Name="MEM_DECOMMIT"        Value="0x4000" />
                <Set Name="MEM_RELEASE"         Value="0x8000" />
                <Set Name="MEM_FREE"            Value="0x10000" />
                <Set Name="MEM_PRIVATE"         Value="0x20000" />
                <Set Name="MEM_MAPPED"          Value="0x40000" />
                <Set Name="MEM_RESET"           Value="0x80000" />
                <Set Name="MEM_TOP_DOWN"        Value="0x100000" />
                <Set Name="MEM_WRITE_WATCH"     Value="0x200000" />
                <Set Name="MEM_PHYSICAL"        Value="0x400000" />
                <Set Name="MEM_ROTATE"          Value="0x800000" />
                <Set Name="MEM_LARGE_PAGES"     Value="0x20000000" />
                <Set Name="MEM_4MB_PAGES"       Value="0x80000000" />
            </Flag>
        </Variable>

        <Variable Name="[MemoryProtection]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Flag>
                <Set Name="PAGE_EXECUTE"            Value="0x10" />
                <Set Name="PAGE_EXECUTE_READ"       Value="0x20" />
                <Set Name="PAGE_EXECUTE_READWRITE"  Value="0x40" />
                <Set Name="PAGE_EXECUTE_WRITECOPY"  Value="0x80" />
                <Set Name="PAGE_NOACCESS"           Value="0x01" />
                <Set Name="PAGE_READONLY"           Value="0x02" />
                <Set Name="PAGE_READWRITE"          Value="0x04" />
                <Set Name="PAGE_WRITECOPY"          Value="0x08" />
                <Set Name="PAGE_GUARD"              Value="0x100" />
                <Set Name="PAGE_NOCACHE"            Value="0x200" />
                <Set Name="PAGE_WRITECOMBINE"       Value="0x400" />
                <Set Name="SEC_COMMIT"              Value="0x8000000" />
                <Set Name="SEC_IMAGE"               Value="0x1000000" />
                <Set Name="SEC_LARGE_PAGES"         Value="0x80000000" />
                <Set Name="SEC_NOCACHE"             Value="0x10000000" />
                <Set Name="SEC_RESERVE"             Value="0x4000000" />
                <Set Name="SEC_WRITECOMBINE"        Value="0x40000000" />
            </Flag>
        </Variable>

        <Variable Name="[MemoryProtection*]" Type="Pointer" Base="[MemoryProtection]">
            <Display Name="PDWORD" />
        </Variable>

        <Variable Name="[AclRevision]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Enum>
                <Set Name="ACL_REVISION"        Value="2" />
                <Set Name="ACL_REVISION_DS"     Value="4" />
            </Enum>
        </Variable>

        <Variable Name="[NtVerType]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Flag>
                <Set Name="VER_MINORVERSION"        Value="0x0000001" />
                <Set Name="VER_MAJORVERSION"        Value="0x0000002" />
                <Set Name="VER_BUILDNUMBER"         Value="0x0000004" />
                <Set Name="VER_PLATFORMID"          Value="0x0000008" />
                <Set Name="VER_SERVICEPACKMINOR"    Value="0x0000010" />
                <Set Name="VER_SERVICEPACKMAJOR"    Value="0x0000020" />
                <Set Name="VER_SUITENAME"           Value="0x0000040" />
                <Set Name="VER_PRODUCT_TYPE"        Value="0x0000080" />
            </Flag>
        </Variable>

        <!-- [TokenAccess] -->
        <Variable Name="[TokenAccess]" Type="Alias" Base="DWORD">
            <Display Name="DWORD" />
            <Flag>
                <Set Name="DELETE"                      Value="0x00010000" />
                <Set Name="READ_CONTROL"                Value="0x00020000" />
                <Set Name="WRITE_DAC"                   Value="0x00040000" />
                <Set Name="WRITE_OWNER"                 Value="0x00080000" />
                <Set Name="ACCESS_SYSTEM_SECURITY"      Value="0x01000000" />
                <Set Name="TOKEN_ASSIGN_PRIMARY"        Value="0x0001" />
                <Set Name="TOKEN_DUPLICATE"             Value="0x0002" />
                <Set Name="TOKEN_IMPERSONATE"           Value="0x0004" />
                <Set Name="TOKEN_QUERY"                 Value="0x0008" />
                <Set Name="TOKEN_QUERY_SOURCE"          Value="0x0010" />
                <Set Name="TOKEN_ADJUST_PRIVILEGES"     Value="0x0020" />
                <Set Name="TOKEN_ADJUST_GROUPS"         Value="0x0040" />
                <Set Name="TOKEN_ADJUST_DEFAULT"        Value="0x0080" />
                <Set Name="TOKEN_ADJUST_SESSIONID"      Value="0x0100" />
                <Set Name="TOKEN_ALL_ACCESS_P"          Value="0xf00ff" />
                <Set Name="TOKEN_ALL_ACCESS"            Value="0xf01ff" />
                <Set Name="TOKEN_READ"                  Value="0x20008" />
                <Set Name="TOKEN_WRITE"                 Value="0x200e0" />
                <Set Name="TOKEN_EXECUTE"               Value="0x20000" />
                <Set Name="MAXIMUM_ALLOWED"             Value="0x02000000" />
            </Flag>
        </Variable>

        <!-- [ObjectAttributes] -->
        <Variable Name="[ObjectAttributes]" Type="Alias" Base="ULONG">
            <Display Name="ULONG" />
            <Flag>
                <Set Name="OBJ_INHERIT"             	Value="0x00000002" />
                <Set Name="OBJ_PERMANENT"           	Value="0x00000010" />
                <Set Name="OBJ_EXCLUSIVE"           	Value="0x00000020" />
                <Set Name="OBJ_CASE_INSENSITIVE"    	Value="0x00000040" />
                <Set Name="OBJ_OPENIF"              	Value="0x00000080" />
                <Set Name="OBJ_OPENLINK"            	Value="0x00000100" />
                <Set Name="OBJ_KERNEL_HANDLE"       	Value="0x00000200" />
                <Set Name="OBJ_FORCE_ACCESS_CHECK"  	Value="0x00000400" />
                <Set Name="OBJ_VALID_ATTRIBUTES"        Value="0x000007F2" />
            </Flag>
        </Variable>

        <!-- OBJECT_ATTRIBUTES -->
        <Variable Name="OBJECT_ATTRIBUTES" Type="Struct">
            <Field Type="ULONG" 	                    Name="Length" />
            <Field Type="HANDLE" 	                    Name="RootDirectory" />
            <Field Type="PUNICODE_STRING" 	            Name="ObjectName" />
            <Field Type="[ObjectAttributes]"            Name="Attributes" />
            <Field Type="PSECURITY_DESCRIPTOR"          Name="SecurityDescriptor" />
            <Field Type="PSECURITY_QUALITY_OF_SERVICE" 	Name="SecurityQualityOfService" />
        </Variable>
        <Variable Name="POBJECT_ATTRIBUTES" Type="Pointer" Base="OBJECT_ATTRIBUTES" />

        <!-- RTL_CRITICAL_SECTION_DEBUG -->
        <Variable Name="RTL_CRITICAL_SECTION_DEBUG" Type="Struct">
            <Field Type="USHORT"        Name="Type" />
            <Field Type="USHORT"        Name="CreatorBackTraceIndex" />
            <!-- TODO: Parent-Reference - CriticalSection is really RTL_CRITICAL_SECTION*-->
            <Field Type="LPVOID"        Name="CriticalSection" Display="RTL_CRITICAL_SECTION*" />
            <Field Type="LIST_ENTRY"    Name="ProcessLocksList" />
            <Field Type="ULONG"         Name="EntryCount" />
            <Field Type="ULONG"         Name="ContentionCount" />
            <Field Type="ULONG [2]"     Name="Spare" />
        </Variable>
        <Variable Name="PRTL_CRITICAL_SECTION_DEBUG" Type="Pointer" Base="RTL_CRITICAL_SECTION_DEBUG" />

        <!-- RTL_CRITICAL_SECTION -->
        <Variable Name="RTL_CRITICAL_SECTION" Type="Struct" Pack="8">
            <Field Type="PRTL_CRITICAL_SECTION_DEBUG"   Name="DebugInfo" />
            <Field Type="LONG"                          Name="LockCount" />
            <Field Type="LONG"                          Name="RecursionCount" />
            <Field Type="HANDLE"                        Name="OwningThread" />
            <Field Type="HANDLE"                        Name="LockSemaphore" />
            <Field Type="ULONG_PTR"                     Name="SpinCount" />
        </Variable>
        <Variable Name="PRTL_CRITICAL_SECTION" Type="Pointer" Base="RTL_CRITICAL_SECTION" />

        <Variable Name="[NtProtectionFlags]" Type="Alias" Base="ULONG">
            <Display Name="ULONG" />
            <Flag>
                <Set Name="PAGE_NOACCESS"           Value="0x01" />
                <Set Name="PAGE_READONLY"           Value="0x02" />
                <Set Name="PAGE_READWRITE"          Value="0x04" />
                <Set Name="PAGE_WRITECOPY"          Value="0x08" />
                <Set Name="PAGE_EXECUTE"            Value="0x10" />
                <Set Name="PAGE_EXECUTE_READ"       Value="0x20" />
                <Set Name="PAGE_EXECUTE_READWRITE"  Value="0x40" />
                <Set Name="PAGE_EXECUTE_WRITECOPY"  Value="0x80" />
                <Set Name="PAGE_GUARD"              Value="0x100" />
                <Set Name="PAGE_NOCACHE"            Value="0x200" />
                <Set Name="PAGE_WRITECOMBINE"       Value="0x400" />
            </Flag>
        </Variable>

    </Headers>
</ApiMonitor>